<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>BlueJelly notify</title>
    <script type="text/javascript" src="https://raw.githubusercontent.com/electricbaka/bluejelly/master/src/bluejelly.js"></script>
</head>

<body>
    <div id="text1">notify, BlueJelly!</div>
    <button id="startNotifications" class="button">Start Notify</button>
    <button id="stopNotifications" class="button">Stop Notify</button>
    <hr>
    <div id="device_name"> </div>
    <div id="uuid_name"> </div>
    <div id="data_text"> </div>
    <div id="status"> </div>
    <script>
        //--------------------------------------------------
        //Global変数
        //--------------------------------------------------
        //BlueJellyのインスタンス生成
        var ble = new BlueJelly();
        //--------------------------------------------------
        //ロード時の処理
        //--------------------------------------------------
        window.onload = function () {
            //UUIDの設定
            ble.setUUID("UUID1", "713d0000-503e-4c75-ba94-3148f18d941e", "713d0002-503e-4c75-ba94-3148f18d941e");  //BLEnano SimpleControl rx_uuid
        }
        //--------------------------------------------------
        //Scan後の処理
        //--------------------------------------------------
        ble.onScan = function (deviceName) {
            document.getElementById('device_name').innerHTML = deviceName;
            document.getElementById('status').innerHTML = "found device!";
        }
        //--------------------------------------------------
        //ConnectGATT後の処理
        //--------------------------------------------------
        ble.onConnectGATT = function (uuid) {
            console.log('> connected GATT!');
            document.getElementById('uuid_name').innerHTML = uuid;
            document.getElementById('status').innerHTML = "connected GATT!";
        }
        //--------------------------------------------------
        //Read後の処理：得られたデータの表示など行う
        //--------------------------------------------------
        ble.onRead = function (data, uuid) {
            //フォーマットに従って値を取得
            value = data.getInt16(0);//2Byteの場合のフォーマット
            //コンソールに値を表示
            console.log(value);
            //HTMLに値を表示
            document.getElementById('data_text').innerHTML = value;
            document.getElementById('uuid_name').innerHTML = uuid;
            document.getElementById('status').innerHTML = "read data"
        }
        //--------------------------------------------------
        //Start Notify後の処理
        //--------------------------------------------------
        ble.onStartNotify = function (uuid) {
            console.log('> Start Notify!');
            document.getElementById('uuid_name').innerHTML = uuid;
            document.getElementById('status').innerHTML = "started Notify";
        }
        //--------------------------------------------------
        //Stop Notify後の処理
        //--------------------------------------------------
        ble.onStopNotify = function (uuid) {
            console.log('> Stop Notify!');
            document.getElementById('uuid_name').innerHTML = uuid;
            document.getElementById('status').innerHTML = "stopped Notify";
        }
        //-------------------------------------------------
        //ボタンが押された時のイベント登録
        //--------------------------------------------------
        document.getElementById('startNotifications').addEventListener('click', function () {
            ble.startNotify('UUID1');
        });
        document.getElementById('stopNotifications').addEventListener('click', function () {
            ble.stopNotify('UUID1');
        });
    </script>

</body>

</html>